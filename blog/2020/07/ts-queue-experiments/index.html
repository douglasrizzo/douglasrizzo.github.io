<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Using task-spooler to queue experiments on Linux | Douglas Meneghetti </title> <meta name="author" content="Douglas De Rizzo Meneghetti"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://douglasrizzo.github.io/blog/2020/07/ts-queue-experiments/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Douglas Meneghetti </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Using task-spooler to queue experiments on Linux</h1> <p class="post-meta"> July 10, 2020 </p> <p class="post-tags"> <a href="/blog/2020"> <i class="fa-solid fa-calendar fa-sm"></i> 2020 </a>   ·   <a href="/blog/tag/linux"> <i class="fa-solid fa-hashtag fa-sm"></i> linux</a>   <a href="/blog/tag/deep-learning"> <i class="fa-solid fa-hashtag fa-sm"></i> deep-learning</a>   <a href="/blog/tag/tutorial"> <i class="fa-solid fa-hashtag fa-sm"></i> tutorial</a>     ·   <a href="/blog/category/tools"> <i class="fa-solid fa-tag fa-sm"></i> tools</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>In this post, I’ll introduce you to <a href="http://viric.name/soft/ts/" rel="external nofollow noopener" target="_blank">task-spooler</a> (“ts” for short), a Linux program that lets you queue tasks to be executed either sequentially or in parallel, according to a user-defined number of slots.</p> <ul> <li><a href="#problem-setting">Problem setting</a></li> <li><a href="#a-crude-solution">A crude solution</a></li> <li><a href="#the-downsides">The downsides</a></li> <li> <a href="#enter-ts">Enter ts</a> <ul> <li><a href="#adding-more-slots-to-the-ts-queue">Adding more slots to the ts queue</a></li> <li><a href="#adding-more-demaning-tasks-to-the-queue">Adding more demaning tasks to the queue</a></li> <li><a href="#monitoring-tasks">Monitoring tasks</a></li> <li><a href="#miscellaneous-functionalities">Miscellaneous functionalities</a></li> </ul> </li> <li><a href="#installing-ts">Installing ts</a></li> <li><a href="#closing-remarks">Closing remarks</a></li> </ul> <h2 id="problem-setting">Problem setting</h2> <p>Let’s say you have a set of experiments to execute on your Linux machine. Each experiment is called via the python command and a script is passed, with some accompanying command-line args. For example, experiment 1 can be called like so:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python train.py <span class="nt">--network</span> 1 <span class="nt">--dataset</span> 1
</code></pre></div></div> <p>Now let’s say there are 5 networks you want to test in 4 different datasets, for a total of 20 experiments. You also know that you can run 3 of these experiments at the same time in a single machine with little to no loss of performance. The question is: what’s an efficient way to automatically execute all of these experiments?</p> <h2 id="a-crude-solution">A crude solution</h2> <p>A crude solution may involve creating 3 shell scripts, or 3 shell functions, which encapsulate equal-sized batches of experiments. For example, one way to go about organizing our experiments is the following.</p> <p>Script 1:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python train.py <span class="nt">--network</span> 1 <span class="nt">--dataset</span> 1
python train.py <span class="nt">--network</span> 1 <span class="nt">--dataset</span> 2
<span class="o">[</span>...]
python train.py <span class="nt">--network</span> 2 <span class="nt">--dataset</span> 3
</code></pre></div></div> <p>Script 2:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python train.py <span class="nt">--network</span> 2 <span class="nt">--dataset</span> 4
python train.py <span class="nt">--network</span> 3 <span class="nt">--dataset</span> 1
<span class="o">[</span>...]
python train.py <span class="nt">--network</span> 4 <span class="nt">--dataset</span> 2
</code></pre></div></div> <p>Script 3:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python train.py <span class="nt">--network</span> 4 <span class="nt">--dataset</span> 3
python train.py <span class="nt">--network</span> 1 <span class="nt">--dataset</span> 2
<span class="o">[</span>...]
python train.py <span class="nt">--network</span> 5 <span class="nt">--dataset</span> 4
</code></pre></div></div> <p>You then run each script/function in a dedicated terminal, maybe using tmux/byobu, and log out of the machine, leaving the experiments to finish.</p> <h2 id="the-downsides">The downsides</h2> <p>One downside of this method is that the computation load has been manually balanced from the start and, if one of our manual queues finish before the others, that queue will not be able to get tasks that are waiting to be executed in our other scripts. This may result in idle computation resources.</p> <p>Another downside of this method is that there is no way to prioritize which experiments should be executed first. We can take an educated guess and say that the first experiment of each manual queue will finish first, then the second experiment of each manual queue and so on. But this method is unpredictable and, with time, the estimate of which experiments are still running or when a specific experiment will end may diverge.</p> <p>The solution to these issues would be to have an easy way to queue all experiments, tell the computer how many of them can be executed in parallel and let it consume the queue of experiments automatically.</p> <h2 id="enter-ts">Enter ts</h2> <p><code class="language-plaintext highlighter-rouge">ts</code> works with the concept of <em>slots</em>. You tell it the maximum number of slots it has to run processes and, when queuing a process, how many slots each process requires. By default, <code class="language-plaintext highlighter-rouge">ts</code> provides a single available slot and each new process also requires one slot by default, so a single task will be executed every time.</p> <p>In order to add a command to the <code class="language-plaintext highlighter-rouge">ts</code> queue, we just have to call the command preceeded by the <code class="language-plaintext highlighter-rouge">ts</code> command. For example, in order to add our experiments to the queue, we would call them like so:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ts python train.py <span class="nt">--network</span> 1 <span class="nt">--dataset</span> 1
ts python train.py <span class="nt">--network</span> 1 <span class="nt">--dataset</span> 2
ts python train.py <span class="nt">--network</span> 1 <span class="nt">--dataset</span> 3
<span class="o">[</span>...]
ts python train.py <span class="nt">--network</span> 5 <span class="nt">--dataset</span> 4
</code></pre></div></div> <p>Or, if you want to get fancy:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 5<span class="si">)</span><span class="p">;</span> <span class="k">do
  for </span>j <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 4<span class="si">)</span><span class="p">;</span> <span class="k">do
    </span>ts python train.py <span class="nt">--network</span> <span class="nv">$i</span> <span class="nt">--dataset</span> <span class="nv">$j</span>
  <span class="k">done
done</span>
</code></pre></div></div> <p>Since <code class="language-plaintext highlighter-rouge">ts</code> provides a single slot by default, only one of the experiments will start executing. The others will stay in the queue and the current terminal will not hang.</p> <p>Please note that, in some systems, the actual program may be called <code class="language-plaintext highlighter-rouge">tsp</code> due to a naming conflict with some other famous Linux program.</p> <h3 id="adding-more-slots-to-the-ts-queue">Adding more slots to the ts queue</h3> <p>In our problem, it seems suitable to tell <code class="language-plaintext highlighter-rouge">ts</code> that it can execute 3 tasks simultaneously, so we go ahead and do that through the <code class="language-plaintext highlighter-rouge">-S</code> flag.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ts <span class="nt">-S</span> 3
</code></pre></div></div> <p>This way, <code class="language-plaintext highlighter-rouge">ts</code> will fill the two newly created slots by running two additional tasks.</p> <h3 id="adding-more-demaning-tasks-to-the-queue">Adding more demaning tasks to the queue</h3> <p>If we have a more demanding task that we want to add to the queue, but only be executed when more than one slot is available in the queue, we can use the <code class="language-plaintext highlighter-rouge">-N</code> to configure how many available slots <code class="language-plaintext highlighter-rouge">ts</code> needs to start the task.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ts <span class="nt">-N</span> 3 python train_big_net.py
</code></pre></div></div> <p>The task above will only start once our whole 3-slot queue is empty. If there are other tasks in the queue that would take less than 3 slots to start, they will not be started, since (by definition) tasks in the queue are executed sequentially.</p> <h3 id="monitoring-tasks">Monitoring tasks</h3> <p>In order to check on the list of processes and their statuses, just call <code class="language-plaintext highlighter-rouge">ts</code> with no arguments. In the example output below, I have called <code class="language-plaintext highlighter-rouge">ts sleep 60</code> a bunch of times with a number of 4 slots:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ID   State      Output               E-Level  Times(r/u/s)   Command [run=4/4]
12   running    /tmp/ts-out.AEnsRv                           sleep 60
13   running    /tmp/ts-out.uDzxH8                           sleep 60
14   running    /tmp/ts-out.pGUSbK                           sleep 60
15   running    /tmp/ts-out.MWfo2l                           sleep 60
16   queued     (file)                                       sleep 60
17   queued     (file)                                       sleep 60
18   queued     (file)                                       sleep 60
19   queued     (file)                                       sleep 60
20   queued     (file)                                       sleep 60
0    finished   /tmp/ts-out.UPIohv   0        60.00/0.00/0.00 sleep 60
1    finished   /tmp/ts-out.l2bBJq   0        60.00/0.00/0.00 sleep 60
6    finished   /tmp/ts-out.4SZ7O2   0        60.00/0.00/0.00 sleep 60
7    finished   /tmp/ts-out.3qkpyK   0        60.00/0.00/0.00 sleep 60
8    finished   /tmp/ts-out.ngun7M   0        60.00/0.00/0.00 sleep 60
9    finished   /tmp/ts-out.Fb5QLU   0        60.00/0.00/0.00 sleep 60
10   finished   /tmp/ts-out.lLGHom   0        60.00/0.00/0.00 sleep 60
11   finished   /tmp/ts-out.0B8fyB   0        60.00/0.00/0.00 sleep 60
</code></pre></div></div> <p>You can see there are 4 processes running, 5 queued and 8 have finished after having been running for (unsurprisingly) 60 seconds.</p> <p>In order to view the output of one of the tasks, there are commands such as <code class="language-plaintext highlighter-rouge">ts -t &lt;task_id&gt;</code> and <code class="language-plaintext highlighter-rouge">ts -c &lt;task_id&gt;</code>.</p> <h3 id="miscellaneous-functionalities">Miscellaneous functionalities</h3> <p>For completion sake, here is the relevant output of <code class="language-plaintext highlighter-rouge">ts -h</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Actions:
  -K       kill the task spooler server
  -C       clear the list of finished jobs
  -l       show the job list (default action)
  -S [num] get/set the number of max simultaneous jobs of the server.
  -t [id]  "tail -n 10 -f" the output of the job. Last run if not specified.
  -c [id]  like -t, but shows all the lines. Last run if not specified.
  -p [id]  show the pid of the job. Last run if not specified.
  -o [id]  show the output file. Of last job run, if not specified.
  -i [id]  show job information. Of last job run, if not specified.
  -s [id]  show the job state. Of the last added, if not specified.
  -r [id]  remove a job. The last added, if not specified.
  -w [id]  wait for a job. The last added, if not specified.
  -k [id]  send SIGTERM to the job process group. The last run, if not specified.
  -u [id]  put that job first. The last added, if not specified.
  -U &lt;id-id&gt;  swap two jobs in the queue.
  -B       in case of full queue on the server, quit (2) instead of waiting.
  -h       show this help
  -V       show the program version
Options adding jobs:
  -n       don't store the output of the command.
  -E       Keep stderr apart, in a name like the output file, but adding '.e'.
  -g       gzip the stored output (if not -n).
  -f       don't fork into background.
  -m       send the output by e-mail (uses sendmail).
  -d       the job will be run only if the job before ends well
  -D &lt;id&gt;  the job will be run only if the job of given id ends well.
  -L &lt;lab&gt; name this task with a label, to be distinguished on listing.
  -N &lt;num&gt; number of slots required by the job (1 default).
</code></pre></div></div> <h2 id="installing-ts">Installing ts</h2> <p>Now that I have got your attention, it is time I teach you how to install <code class="language-plaintext highlighter-rouge">ts</code> . In some Linux distributions, ts is available either via official or unofficial repositories. For example, in Arch-based systems, you can find it in the AUR:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yay <span class="nt">-S</span> task-spooler
</code></pre></div></div> <p>In Debian:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>task-spooler
</code></pre></div></div> <p>However, it is not available in all distros, but it is quite easy to download source from <a href="http://viric.name/soft/ts/" rel="external nofollow noopener" target="_blank">the developer’s website</a> and do the good old untar/ <code class="language-plaintext highlighter-rouge">make</code> / <code class="language-plaintext highlighter-rouge">make install</code> combo.</p> <h2 id="closing-remarks">Closing remarks</h2> <p><code class="language-plaintext highlighter-rouge">ts</code> is an extremely simple Linux program that follows the Unix philosophy to the letter: it does a single job and does it well. There are many other functionalities I haven’t covered here, but you can cancel queued tasks, consult the output of running and queued tasks and so on.</p> <p>I understand that there may be a fancier solution to this problem, probably using enterprise-grade software that I an unfamiliar with. However, since most small-time researchers, grad students and hobbyists will really only be using the Linux command-line to ssh on a remote server or run local experiments, I believe having <code class="language-plaintext highlighter-rouge">ts</code> in the toolbelt is very beneficial.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/03/local-gemma-chatbot-langchain-ollama/">Running a Gemma-powered question-answering chatbot locally with LangChain + Ollama</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/02/llm-qa-obsidian-rag/">Answering questions from an Obsidian database with LLMs + RAG</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/06/mathematics-self-study/">Resources to self-study mathematics for machine learning</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/08/tf-obj-tutorial/">How to train your own object detection models using the TensorFlow Object Detection API (2020 Update)</a> </li> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Douglas De Rizzo Meneghetti. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>