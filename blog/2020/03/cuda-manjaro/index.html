<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Installing CUDA 10.1 and cuDNN 7.6 on Manjaro Linux | Douglas Meneghetti </title> <meta name="author" content="Douglas De Rizzo Meneghetti"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://douglasrizzo.github.io/blog/2020/03/cuda-manjaro/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Douglas Meneghetti </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Installing CUDA 10.1 and cuDNN 7.6 on Manjaro Linux</h1> <p class="post-meta"> March 16, 2020 </p> <p class="post-tags"> <a href="/blog/2020"> <i class="fa-solid fa-calendar fa-sm"></i> 2020 </a>   ·   <a href="/blog/tag/linux"> <i class="fa-solid fa-hashtag fa-sm"></i> linux</a>   <a href="/blog/tag/nvidia"> <i class="fa-solid fa-hashtag fa-sm"></i> nvidia</a>   <a href="/blog/tag/deep-learning"> <i class="fa-solid fa-hashtag fa-sm"></i> deep-learning</a>     ·   <a href="/blog/category/tools"> <i class="fa-solid fa-tag fa-sm"></i> tools</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <ul> <li><a href="#introduction">Introduction</a></li> <li><a href="#uninstall-what-was-wrongfully-installed">Uninstall what was wrongfully installed</a></li> <li> <a href="#installdowngrade-nvidia-drivers">Install/downgrade NVIDIA drivers</a> <ul> <li><a href="#restart-computer-and-test-drivers">Restart computer and test drivers</a></li> </ul> </li> <li> <a href="#install-cuda-101-and-cudnn-76">Install CUDA 10.1 and cuDNN 7.6</a> <ul> <li><a href="#cuda">CUDA</a></li> <li><a href="#cudnn">cuDNN</a></li> <li><a href="#edit-profile">Edit <code class="language-plaintext highlighter-rouge">.profile</code></a></li> </ul> </li> </ul> <h2 id="introduction">Introduction</h2> <p>If you use Manjaro Linux and want to use TensorFlow or PyTorch with GPU support, you’ll need to install a version of CUDA that works with these libraries. As of the time of this writing, that is CUDA 10.1, which is compatible with cuDNN 7.6.5 and only works under NVIDIA drivers &gt;= 418.39 and &lt; 440.33 <a href="https://docs.nvidia.com/deploy/cuda-compatibility/index.html#binary-compatibility__table-toolkit-driver" rel="external nofollow noopener" target="_blank">[source]</a>.</p> <p>Nowadays, the drives installed automatically by Manjaro are only compatible with CUDA 10.2. So, in order for our deep learning packages to work, a downgrade is necessary, both in the video drivers and in CUDA, in case you have installed it.</p> <p>Let’s get to it.</p> <h2 id="uninstall-what-was-wrongfully-installed">Uninstall what was wrongfully installed</h2> <p>First, make sure you don’t have any version of CUDA or cuDNN installed. If you’ve installed them via <code class="language-plaintext highlighter-rouge">pacman</code> (<code class="language-plaintext highlighter-rouge">cuda</code> and <code class="language-plaintext highlighter-rouge">cudnn</code> package, respectively), uninstall them before the next steps, or else Manjaro won’t let you swap drivers when the time comes.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>pacman <span class="nt">-R</span> cuda cudnn
</code></pre></div></div> <h2 id="installdowngrade-nvidia-drivers">Install/downgrade NVIDIA drivers</h2> <p>If you are already using your video card for something on your system, such as gaming, chances are Manjaro has installed the most recent NVIDIA drivers, which are incompatible with CUDA 10.1 and need to be uninstalled.</p> <p>At the time of this writing, the preferred package is <code class="language-plaintext highlighter-rouge">video-nvidia-440xx</code>, which installs version 440.64 of the drivers. Since we’re working with Manjaro, I suggest uninstalling the drivers using the the <code class="language-plaintext highlighter-rouge">mhwd</code> tool, like so:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>mhwd <span class="nt">-r</span> pci video-nvidia-440xx
</code></pre></div></div> <p>This should not make your video card stop working immediately (as in receive a black screen right after this command). At least, it didn’t happen to me.</p> <p>If you don’t have video drivers installed or have just uninstalled them, now it’s time to install the most recent version of the proprietary drivers compatible with CUDA 10.1. Any version before 440.39 should suffice, but <code class="language-plaintext highlighter-rouge">mhwd</code> provides 435.21 nicely bundled and that should be enough for us:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>mhwd <span class="nt">-i</span> pci video-nvidia-435xx
</code></pre></div></div> <h3 id="restart-computer-and-test-drivers">Restart computer and test drivers</h3> <p>This is a good time to restart the computer and check if it correctly loads the new drivers and detects the NVIDIA graphics card. A good test is to run the <code class="language-plaintext highlighter-rouge">nvidia-smi</code> command after a reboot and check that the command lists information like this:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mon Mar 16 08:11:11 2020
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 435.21       Driver Version: 435.21       CUDA Version: 10.1     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  GeForce GTX 1070    Off  | 00000000:01:00.0  On |                  N/A |
| 27%   40C    P0    34W / 151W |     72MiB /  8117MiB |      0%      Default |
+-------------------------------+----------------------+----------------------+


+-----------------------------------------------------------------------------+
| Processes:                                                       GPU Memory |
|  GPU       PID   Type   Process name                             Usage      |
|=============================================================================|
|    0      9630      G   /usr/lib/Xorg                                 72MiB |
+-----------------------------------------------------------------------------+
</code></pre></div></div> <h2 id="install-cuda-101-and-cudnn-76">Install CUDA 10.1 and cuDNN 7.6</h2> <h3 id="cuda">CUDA</h3> <p><code class="language-plaintext highlighter-rouge">pacman</code> provides CUDA 10.2 and upwards in package <code class="language-plaintext highlighter-rouge">cuda</code>, but we need version 10.1, which we’ll install from the AUR:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yay <span class="nt">-S</span> cuda-10.1
</code></pre></div></div> <h3 id="cudnn">cuDNN</h3> <p>cuDNN is available via pacman as <code class="language-plaintext highlighter-rouge">cudnn</code>, but, even though it lists <code class="language-plaintext highlighter-rouge">cuda&gt;=10</code> as a dependency and we’ve just installed <code class="language-plaintext highlighter-rouge">cuda-10.1</code>, it doesn’t recognize the requirement as met (probably because it came from the AUR) and tries to install the pacman <code class="language-plaintext highlighter-rouge">cuda</code> package, whose version is 10.2. In order to bypass that:</p> <ol> <li>go to the AUR page for the cudnn package. The commit we want (containing version 7.6) is <a href="https://git.archlinux.org/svntogit/community.git/tree/repos/community-x86_64?h=packages/cudnn&amp;id=c8950411997c56322bb06bb1388189401911287a" rel="external nofollow noopener" target="_blank">this one</a>;</li> <li>download the PKGBUILD and accompanying PDF file;</li> <li>edit the PKGBUILD file, removing the line saying <code class="language-plaintext highlighter-rouge">depends=('cuda&gt;=10')</code>;</li> <li>inside the directory with the edited PKGBUILD file and accompanying PDF file, use the commands:</li> </ol> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>makepkg
makepkg <span class="nt">--install</span>
</code></pre></div></div> <p>Now you should have cuDNN installed.</p> <h3 id="edit-profile">Edit <code class="language-plaintext highlighter-rouge">.profile</code> </h3> <p>Add the following lines to your <code class="language-plaintext highlighter-rouge">.profile</code> file, appending the location of the CUDA executables and include libraries and provided libraries to <code class="language-plaintext highlighter-rouge">PATH</code>, <code class="language-plaintext highlighter-rouge">CPATH</code> and <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>, respectively:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/opt/cuda-10.1/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">CPATH</span><span class="o">=</span><span class="s2">"/opt/cuda-10.1/include:</span><span class="nv">$CPATH</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">:/opt/cuda-10.1/lib64:/opt/cuda-10.1/lib"</span>
</code></pre></div></div> <p>Logout and login back again for the changes in <code class="language-plaintext highlighter-rouge">.profile</code> to take effect.</p> <hr> <p>Now you should be all setup to use CUDA 10.1 and cuDNN natively on your Manjaro computer. I have successfully used this procedure both for TensorFlow and PyTorch. Happy coding!</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/03/local-gemma-chatbot-langchain-ollama/">Running a Gemma-powered question-answering chatbot locally with LangChain + Ollama</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/02/llm-qa-obsidian-rag/">Answering questions from an Obsidian database with LLMs + RAG</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/07/ts-queue-experiments/">Using task-spooler to queue experiments on Linux</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/08/tf-obj-tutorial/">How to train your own object detection models using the TensorFlow Object Detection API (2020 Update)</a> </li> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 Douglas De Rizzo Meneghetti. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>